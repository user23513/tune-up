<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">
<head>
<meta charset="UTF-8">
<title>전자결재 - 관리 기능</title>
<!-- <link rel="stylesheet"
	href="https://cdn.datatables.net/v/dt/dt-1.11.4/r-2.2.9/datatables.min.css" />
<script
	src="https://cdn.datatables.net/v/dt/dt-1.11.4/r-2.2.9/datatables.min.js"></script> -->
<link rel="stylesheet" type="text/css"
	href="https://cdn.datatables.net/v/bs5/dt-1.12.1/datatables.min.css" />
<script type="text/javascript"
	src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript"
	src="https://cdn.datatables.net/v/bs5/dt-1.12.1/datatables.min.js"></script>

<style>
table * {
	border-radius: 5px 5px 5px 5px;
}

.form-control {
	justify-content: end;
}

*:focus {
	outline: 0;
}
</style>
</head>
<body>
	<!-- ======= Main ======= -->
	<main id="main" class="main" layout:fragment="content">

		<script>
			//로딩화면
			loadin(); 
			function loadin(load) {
	 			LoadingWithMask("/assets/img/load.gif");
	  			setTimeout("closeLoadingWithMask()", 300);
			} 
			function LoadingWithMask(gif) {
				var maskHeight = $(document).height();
				var maskWidth  = window.document.body.clientWidth;
	  
	  			let mask = "<div id='mask' class='row' style='position:absolute; z-index:9000; background-color:#ffffff; text-align:center; display:none; left:0; top:0;'></div>";
	  			let loadingImg = '';
	  			loadingImg += "<div id='loadingImg' class='col align-self-center'>";    
	 			loadingImg += " <img src='"+ gif + "' style='position: relative; display: block; margin: 0px auto;'/>";
	  			loadingImg += "</div>";
	  			$('#main').append(mask);
	  			$('#mask').css({'width' : maskWidth +20 , 'height': maskHeight +60});
	  			$('#mask').append(loadingImg);
	  			$('#mask').show();
			}
			function closeLoadingWithMask() {    
				$('#mask').remove();
				$('#mask').empty();
			}	

			
			$(document).ready(function() {
					
				//데이터테이블
				$('#aprvTable').DataTable({
					"dom":'lftip',
					"language": {
			   		"search": ""
			 		},
					
					lengthChange: false,
					ordering: false,
					info: false
			
				});
		
		
				$('#formTable').DataTable({
					"dom":'lftip',
					"language": {
		   			"search": ""
					},
					lengthChange: false,	
					ordering: false,
					info: false	
				});
		

			//새로고침 후 탭 고정
			$('button[data-bs-toggle="tab"]').on("shown.bs.tab", function (e) {
			    let id = $(e.target).attr("data-bs-target");
			    localStorage.setItem('selectTab', id)
			});

				let selectTab = localStorage.getItem('selectTab');
			
			if ( selectTab ) {
			    $('[data-bs-target="' + selectTab + '"]').tab('show');
			    
			} else{
				$('[data-bs-target="#aprv-list"]').tab('show');
			}
			
			//상태카테고리변경
			$("#reqAdBtns").on("click", "button", e=>{
					let reqSt = $(e.target).data("st"); 	
					console.log("오이잉" + reqSt);
					location.href=`/aprvAdmin?reqSt=${reqSt}`;
			});
				
			$("#formAdBtns").on("click", "button", e=>{
					let formCat = $(e.target).data("cat"); 
					location.href=`/aprvAdmin?formCat=${formCat}`;
			});
			
			/* aprvSelect();
			formSelect();
			//상세조회
			function aprvSelect() {
				$("#aprvtb").on("click", ".select", e=>{
					let no = $(e.target).data("no"); //글번호
					$("#aprvNo").val(no)
					$("#aprvfrm").submit();
				})
			}
		
			function formSelect() {
				$("#formtb").on("click", ".select", e=>{
					let no = $(e.target).data("no"); //글번호
					$("#formNo").val(no)
					$("#formfrm").submit();
				})
			} */
			
			});
	</script>

		<!-- ======= Section ======= -->
		<section class="section">

			<div class="card">
				<div class="card-body">

					<br>

					<!-- Page Title -->
					<div class="pagetitle">
						<h1>전자결재</h1>
						<nav>
							<ol class="breadcrumb">
								<li class="breadcrumb-item"><a href="aprvReq">나의 신청</a></li>
								<li class="breadcrumb-item"><a href="approval">나의 승인</a></li>
								<li class="breadcrumb-item active">관리 기능</li>
							</ol>
						</nav>
					</div>
					<!-- End Page Title -->

					<!-- navList -->
					<ul class="nav nav-tabs nav-tabs-bordered" id="bodyTab"
						role="tablist">
						<li class="nav-item" role="presentation">
							<button class="nav-link active" id="aprv-tab"
								data-bs-toggle="tab" data-bs-target="#aprv-list" type="button"
								role="tab" aria-controls="aprv" aria-selected="true">전체결재확인</button>
						</li>
						<li class="nav-item" role="presentation">
							<button class="nav-link" id="form-tab" data-bs-toggle="tab"
								data-bs-target="#form-list" type="button" role="tab"
								aria-controls="form" aria-selected="false">전체서식관리</button>
						</li>

					</ul>
					<!-- End navList -->


					<!-- Bordered Tabs -->
					<div class="tab-content pt-2" id="bodyTabContent">
						<div class="tab-pane fade show active" id="aprv-list"
							role="tabpanel" aria-labelledby="aprv-tab">

							<br>

							<!-- Card with an image on left -->
							<div class="card mb-3">
								<div class="row g-0">
									<div class="col-md-4">
										<img src="assets/img/aprvAdmin.jpg"
											class="img-fluid rounded-start" alt="..."
											style="width: 350px;">
									</div>
									<div class="col-md-8">
										<div class="card-body">
											<br>
											<h5 class="card-title">전체결재목록</h5>
											<p class="card-text">전체결재문서 목록입니다. 모든 문서를 조회할 수 있습니다. 상세
												조회 화면에서 강제 반려, 결재, 수정 및 삭제할 수 있습니다.</p>
										</div>
									</div>
								</div>
							</div>
							<!-- End Card with an image on left -->

							<div class="card">
								<div class="card-body">
									<div class="row">
										<div class="col text-center">

											<br>

											<div class="btn-group" id="reqAdBtns" role="group"
												aria-label="Aprv Request List" style="width: 100%;">
												<button type="button" th:each="s:${st}"
													class="btn btn-outline-primary" th:text="${s.cdNm}"
													th:data-st="${s.cdNm}">전체</button>
											</div>

										</div>
									</div>

									<br>
									<table id="aprvTable" class="display center"
										style="width: 100%">
										<thead hidden="hidden">
											<tr>
												<th>내용</th>
											</tr>
										</thead>
										<tbody id="aprvtb">
											<tr class="list-group" id="aprvListDiv" th:each="p : ${aprv}">
												<td>
													<div
														class="list-group-item list-group-item-action aprvGroup"
														aria-current="true" th:data-no="${p.aprvNo}">
														<div class="d-flex w-100 justify-content-between">
															<p class="mb-1 fw-bold" th:text="${p.ttl}">Some
																placeholder content in a paragraph.</p>
															<span th:if="${p.reqSt == '전송' or p.reqSt =='반려'  }"
																th:text="${p.reqSt}"
																class="badge bg-primary rounded-pill"
																style="height: 25px">수정가능</span> <span
																th:unless="${p.reqSt == '전송' or p.reqSt =='반려'  }"
																th:text="${p.reqSt}"
																class="badge bg-secondary rounded-pill"
																style="height: 25px">수정불가</span>
														</div>
														<small>And some small print.</small>
													</div>
											
												</td>
											</tr>

										</tbody>
									</table>


								</div>
							</div>

							<div>
								<form id="aprvfrm" method="post" action="aprvSelect">
									<input type="hidden" th:name="${_csrf.parameterName}"
										th:value="${_csrf.token}"> <input type="hidden"
										id="aprvNo" name="aprvNo">
								</form>
							</div>
						</div>

						<!-- Tabs Gap -->
						<div class="tab-pane fade" id="form-list" role="tabpanel"
							aria-labelledby="form-tab">

							<br>

							<!-- Card with an image on left -->
							<div class="card mb-3">
								<div class="row g-0">
									<div class="col-md-4">
										<img src="assets/img/aprvAdminForm.jpg"
											class="img-fluid rounded-start" alt="..."
											style="width: 350px;">
									</div>
									<div class="col-md-8">
										<div class="card-body">
											<br>
											<h5 class="card-title">전체서식목록</h5>
											<p class="card-text">모든 결재서식입니다. 서식을 클릭하시면 해당 양식을 확인하거나
												수정 또는 삭제가 가능합니다.</p>
										</div>
									</div>
								</div>
							</div>
							<!-- End Card with an image on left -->

							<div class="card">
								<div class="card-body">

									<br>

									<div class="row">
										<div class="col text-center">
											<div class="btn-group" role="group" id="formAdBtns"
												aria-label="Aprv Form List" style="width: 100%">
												<button type="button" th:each="t:${cat}"
													class="btn btn-outline-primary" th:text="${t.cdNm}"
													th:data-cat="${t.cdNm}">전체</button>
											</div>
										</div>
									</div>

									<br>

									<table id="formTable" class="display center"
										style="width: 100%">
										<thead hidden="hidden">
											<tr>
												<th>전체</th>
											</tr>
										</thead>
										<tbody id="formtb">
											<tr class="list-group" id="formListDiv" th:each="f : ${form}">
												<td>
													<div
														class="list-group-item list-group-item-action formGroup"
														aria-current="true" th:data-no="${f.formNo}">
														<div class="d-flex w-100 justify-content-between">
															<p class="mb-1 fw-bold" th:text="${f.formNm}">Some
																placeholder content in a paragraph.</p>
															<span th:if="${f.formCat == '개인'}" th:text="${f.formCat}"
																class="badge bg-primary rounded-pill"
																style="height: 25px"></span> <span
																th:unless="${f.formCat == '개인'}" th:text="${f.formCat}"
																class="badge bg-secondary rounded-pill"
																style="height: 25px">기타</span>
														</div>
														<small>And some small print.</small>
													</div>
												</td>
											</tr>
										</tbody>
									</table>

								</div>


								<div>
									<form id="formfrm" method="post" action="formSelect">
										<input type="hidden" th:name="${_csrf.parameterName}"
											th:value="${_csrf.token}"> <input type="hidden"
											id="formNo" name="formNo">
									</form>
								</div>

							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- End Bordered Tabs -->

		</section>
		<!-- ======= End Section ======= -->




		<!-- Scrolling Modal -->

		<div class="modal fade" id="scrollingModal" tabindex="-1"
			data-bs-backdrop="false">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Scrolling Modal</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"
							aria-label="Close"></button>
					</div>
					<div class="modal-body" style="min-height: 750px;">Non omnis
						incidunt qui sed occaecati magni asperiores est mollitia.</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-bs-dismiss="modal">Close</button>
						<button type="button" class="btn btn-primary">Save
							changes</button>
					</div>
				</div>
			</div>
		</div>
		<!-- End Scrolling Modal-->






	</main>
	<!-- End #main -->
</body>
</html>