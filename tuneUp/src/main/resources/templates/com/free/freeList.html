<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{layout/layout}">
<head>
<meta charset="UTF-8">
<meta id="_csrf" name="_csrf" th:content="${_csrf.token}"/>
<meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}"/>
<title>Insert title here</title>
<script src="/js/jquery-3.6.1.min.js"></script>
<script>
$(document).ready(function() {
		freeSelect();
		
		//자유게시판 상세조회
		function freeSelect() {
			$("#freeTb").on("click", "tr", e=>{
				let no = $(e.target).parent().data("no"); //게시글 번호
				$("#postNo").val(no)
				$("#frm").submit();
			})
		}
		
		//페이지네이션 처리
		$("#pagenationNav").on("click", "a", e=>{
			var token = $("meta[name='_csrf']").attr("content");
			var header = $("meta[name='_csrf_header']").attr("content");
			console.log($(e.target).text())
			let pageNum = $(e.target).text();
			 
			$.ajax({
				url:'freeAjaxList',
				beforeSend:function(xhr){
		 	  		xhr.setRequestHeader(header,token);  
		     	  },
		    	type:"post",
		        data:{'pageNum':pageNum},
		        dataType:'json',
		        success:function(freeList){
		        	console.log(freeList);
		        	$("#tb").html("");
		        	$.each (freeList, (idx, f)=> {
		        		$("<tr>").attr("data-no", f.postNo).append($("<td>").text(f.rn))
		        		         .append($("<td>").text(f.ttl))
		        		         .append($("<td>").text(f.wrtr))
		        		         .append($("<td>").text(f.writeDt))
		        		         .append($("<td>").text(f.hit))
		        		         .appendTo($("#tb"))
		        	}); 
		        }
		    }) 
		})
		
	} );
</script>
<style>
</style>
</head>
<body>
	<main layout:fragment="content">
		<!-- Start 페이지 제목 -->
		<div class="pagetitle">
			<h1>자유게시판</h1>
		</div>
		<!-- End 페이지 제목 -->
		
		<!-- Start 자유게시판 전체 리스트 -->
		<div class="card">
			<div class="card-body">
			    <h5 class="card-title"></h5>
				<table id="freeTb" class="table">
					<thead>
						<tr>
							<th>#</th>
							<th>제목</th>
							<th>작성자</th>
							<td>작성날짜</th>
							<th>조회수</th>
						</tr>
					</thead>
					<tbody id="tb">
						<tr th:each="f:${freeList}" th:attr="data-no=${f.postNo}">
							<td>[[${f.rn}]]</td>
							<td>[[${f.ttl}]]</td>
							<td>[[${f.wrtr}]]</td>
							<td>[[${f.writeDt}]]</td>
							<td>[[${f.hit}]]</td>
						</tr>
					</tbody>
				</table>
				<a href="freeInsertForm">글쓰기</a>
				
				<!-- 
				<div th:object="${pageMaker}">
                    <div class="big-width" style="text-align: center">
                        <a class="changePage" th:if="*{prev}" th:href="*{startPage - 1}"><code>&lt;</code></a>
                        <th:block th:each="num : ${#numbers.sequence(pageMaker.startPage, pageMaker.endPage)}">
                            <code th:if="${pageMaker.pageNum == num}" th:text="${num}"></code>
                            <a class="changePage" th:unless="${pageMaker.paging.getPageNum() == num}" th:href="${num}"><code th:text="${num}"></code></a>
                        </th:block>
                        <a class="changePage" th:if="*{next}" th:href="*{endPage + 1}"><code>&gt;</code></a>
                    </div>
                    <div class="small-width" style="text-align: center">
                        <a class="changePage" th:if="*{paging.pageNum > 1}" th:href="*{paging.pageNum - 1}"><code>&lt;</code></a>
                        <code th:text="*{paging.pageNum}"></code>
                        <a class="changePage" th:if="*{paging.pageNum < realEnd}" th:href="*{paging.pageNum + 1}"><code>&gt;</code></a>
                    </div>
                    <form action="/board/list" th:object="${paging}" name="pageForm">
                        <input type="hidden" name="pageNum" th:field="*{pageNum}">
                        <input type="hidden" name="amount" th:field="*{amount}">
                    </form>
                </div>
				  -->
				
				<!-- Disabled and active states -->
	            <nav aria-label="..." id="pagenationNav">
	                <ul class="pagination"> 
	                  <li class="page-item disabled">
	                    <a class="page-link" href="freeList" tabindex="-1" aria-disabled="true">Previous</a>
	                  </li>
	                  <li id="li" class="page-item" th:each="num : ${#numbers.sequence(page.startPage,page.realEnd)}">
	                  	<a id="pageNum" class="page-link" href="#" th:text="${num}"></a>
	                  </li>
	                  <li class="page-item">
	                    <a class="page-link" href="#">Next</a>
	                  </li>
	                </ul>
	            </nav>
	            <!-- End Disabled and active states -->
			</div>
		</div>
		<!-- End 자유게시판 전체 리스트 -->
			<div>
				<form id="frm" method="post" action="freeSelect">
					<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
					<input type="hidden" id="postNo" name="postNo">
				</form>
			</div>
	</main>
</body>
</html>