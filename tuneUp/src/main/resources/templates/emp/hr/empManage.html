<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="/js/jquery-3.6.1.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/v/dt/dt-1.11.4/r-2.2.9/datatables.min.css"/>
<script src="https://cdn.datatables.net/v/dt/dt-1.11.4/r-2.2.9/datatables.min.js"></script>
<script>
	$(document).ready(function() {
		//datatables
		$('#empList').DataTable();
		$('#managerList').DataTable();
	
	
	$("#tb").on("click", "tr", e=>{
        let tg = e.target.closest('tr').children[1].innerText;
        console.log(tg)
        $("#empNo").val(tg)
        console.log(e.target)
        $("#frm").submit();
    })
 
    
	$("#ok").on("click", e=>{
	   e.stopPropagation();
	   let auth = e.target.closest('td').previousElementSibling.innerText;
 	   if(auth=='GUEST'){
		   let really = confirm("권한을 USER로 바꾸시겠습니까?");
	      if(really){

	    	  let target = e.target.closest('td').previousElementSibling.setAttribute('th:text', 'USER')
	      }
	   }else{
		   alert("이미 승인되어있습니다.") 
	   } 
	   console.log(auth);
	})
	
	});
			

</script>
</head>
<body>
	<main id="main" class="main" layout:fragment="content">

		<div class="pagetitle">
			<h1>사원관리</h1>
			<nav>
				<ol class="breadcrumb">
					<li class="breadcrumb-item"><a href="index.html">Home</a></li>
					<li class="breadcrumb-item">Components</li>
					<li class="breadcrumb-item active">Tabs</li>
				</ol>
			</nav>
		</div>
		<!-- End Page Title -->

		<section class="section">
			<div class="row">
				<div>

					<div class="card">
						<div class="card-body">
							<h6 class="card-title"></h6>

							<!-- Default Tabs -->
							<ul class="nav nav-tabs" id="myTab" role="tablist">
								<li class="nav-item" role="presentation">
									<button class="nav-link active" id="home-tab"
										data-bs-toggle="tab" data-bs-target="#home" type="button"
										role="tab" aria-controls="home" aria-selected="true">전체사원관리</button>
								</li>
								<li class="nav-item" role="presentation">
									<button class="nav-link" id="contact-tab" data-bs-toggle="tab"
										data-bs-target="#contact" type="button" role="tab"
										aria-controls="contact" aria-selected="false">관리자</button>
								</li>
							</ul>
							
							
							<div class="tab-content pt-2" id="myTabContent">
								<div class="tab-pane fade show active" id="home" role="tabpanel"
									aria-labelledby="home-tab">

									<!-- End Default Table Example -->
									<br>
									<!-- 전체사원목록 보이는 곳 -->
									<!-- Table with hoverable rows -->
									<table class="table table-hover" id="empList">
										<thead>
											<tr>
												<th scope="col">NO</th>
												<th scope="col">사원번호</th>
												<th scope="col">성명</th>
												<th scope="col">부서</th>
												<th scope="col">직위</th>
												<th scope="col">생년월일</th>
												<th scope="col">입사일</th>
												<th scope="col">휴대폰</th>
												<th scope="col">이메일</th>
												<th scope="col">권한</th>
												<th scope="col">승인</th>
											</tr>
										</thead>
										<tbody id="tb">
											<tr th:each="e : ${empList}" >
												<th scope="row"></th>
												<td th:text="${e.empNo}" th:attr="data-no=${e.empNo}">HR100</td>
												<td th:text="${e.nm}">김인사</td>
												<td th:text="${e.dept}">인사</td>
												<td th:text="${e.position}">대리</td>
												<td th:text="${e.birth}">1980-02-25</td>
												<td th:text="${e.hDate}">2010-01-01</td>
												<td th:text="${e.phone}">010-0000-0000</td>
												<td th:text="${e.email}">aaa1234@gmail.com</td>
												<td th:text="${e.auth}" th:attr="data-no=${e.auth}"> </td>
												<td>
													<button id="ok" type="button" class="btn btn-primary btn-sm">승인</button>
												</td>
											</tr>
										</tbody>
									</table>
									<!-- End Table with hoverable rows -->
								</div>
								
								
								<div class="tab-pane fade" id="contact" role="tabpanel"
									aria-labelledby="contact-tab">
									<br>
									<!-- 관리자 목록 보이는 곳 -->
									<!-- Table with hoverable rows -->
									<table class="table table-hover" id="managerList">
										<thead>
											<tr>
												<th scope="col">NO</th>
												<th scope="col">사원번호</th>
												<th scope="col">성명</th>
												<th scope="col">부서</th>
												<th scope="col">직위</th>
												<th scope="col">생년월일</th>
												<th scope="col">입사일</th>
												<th scope="col">휴대폰</th>
												<th scope="col">이메일</th>
												<th scope="col">권한</th>
											</tr>
										</thead>
										<tbody id="tbd">
											<tr th:each="m : ${managerList}" th:if="m.auth">
												<th scope="row"></th>
												<td th:text="${m.empNo}" th:attr="data-no=${m.empNo}"> </td>
												<td th:text="${m.nm}">김인사</td>
												<td th:text="${m.dept}">인사</td>
												<td th:text="${m.position}">대리</td>
												<td th:text="${m.birth}">1980-02-25</td>
												<td th:text="${m.hDate}">2010-01-01</td>
												<td th:text="${m.phone}">010-0000-0000</td>
												<td th:text="${m.email}">aaa1234@gmail.com</td>
												<td th:text="${m.auth}"> </td>
											</tr>
										</tbody>
									</table>
									<!-- End Table with hoverable rows -->
								</div>
								<h6 class="card-title"></h6>
							</div>
							<!-- End Default Tabs -->

						</div>
					</div>

				</div>

			</div>
		</section>
	  <div>
		<form id="frm" method="post" action="empUpdateForm">
			<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
			<input type="hidden" id="empNo" name="empNo">
		</form>
	  </div>
	</main>
	
	<!-- End #main -->
</body>
</html>