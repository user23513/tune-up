<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">
<head>
<meta charset="UTF-8">
<meta id="_csrf" name="_csrf" th:content="${_csrf.token}" />
<meta id="_csrf_header" name="_csrf_header"
	th:content="${_csrf.headerName}" />
<title>프로젝트 관리</title>
<link rel="stylesheet" href="/css/jquery.treeview.css" />
<link rel="stylesheet" href="/css/screen.css" />
<script type="text/javascript">
$(document).ready(function(){
	$("#browser").treeview({}); 
});
</script>
</head>
<body>
	<main id="main" class="main" layout:fragment="content">

		<div class="pagetitle">
			<h1>프로젝트 관리</h1>
			<nav>
				<ol class="breadcrumb">
					<li class="breadcrumb-item"><a href="/">Home</a></li>
					<li class="breadcrumb-item">내 프로젝트</li>
					<li class="breadcrumb-item active">관리</li>
				</ol>
			</nav>
		</div>
		<!-- End Page Title -->

		<section class="section">
			<div class="row align-items-top">
				<div>


					<div>
						<div>

							<!--상태변경 모달 -->
							<button type="button" class="btn btn-outline-primary"
								data-bs-toggle="modal" data-bs-target="#basicModal"
								style="float: right">상태 변경</button>
							<div class="modal fade" id="basicModal" tabindex="-1">
								<div class="modal-dialog">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title">상태</h5>
											<button type="button" class="btn-close"
												data-bs-dismiss="modal" aria-label="Close"></button>
										</div>
										<div class="modal-body">
											<fieldset class="row mb-3">
												<legend class="col-form-label col-sm-2 pt-0">상태</legend>
												<div class="col-sm-10">
													<div class="form-check">
														<input class="form-check-input" type="radio"
															name="gridRadios" id="gridRadios1" value="option1"
															checked> <label class="form-check-label"
															for="gridRadios1"> 요청 </label>
													</div>
													<div class="form-check">
														<input class="form-check-input" type="radio"
															name="gridRadios" id="gridRadios2" value="option2">
														<label class="form-check-label" for="gridRadios2">
															진행 </label>
													</div>
													<div class="form-check disabled">
														<input class="form-check-input" type="radio"
															name="gridRadios" id="gridRadios3" value="option3">
														<label class="form-check-label" for="gridRadios3">
															완료 </label>
													</div>
												</div>
											</fieldset>
										</div>
										<div class="modal-footer">
											<button type="button" class="btn btn-secondary"
												data-bs-dismiss="modal">닫기</button>
											<button type="button" class="btn btn-primary">변경</button>
										</div>
									</div>
								</div>
							</div>
							<!-- 상태 변경 모달 끝-->

							<!--멤버 관리자 탭 -->
							<ul class="nav nav-tabs nav-tabs-bordered" id="borderedTab"
								role="tablist">
								<li class="nav-item" role="presentation">
									<button class="nav-link active" id="home-tab"
										data-bs-toggle="tab" data-bs-target="#bordered-home"
										type="button" role="tab" aria-controls="home"
										aria-selected="true">멤버</button>
								</li>
								<li class="nav-item" role="presentation">
									<button class="nav-link" id="profile-tab" data-bs-toggle="tab"
										data-bs-target="#bordered-profile" type="button" role="tab"
										aria-controls="profile" aria-selected="false">관리자</button>
								</li>


							</ul>
							<!-- 멤버 탭 -->
							<div class="tab-content pt-2" id="borderedTabContent">
								<div class="tab-pane fade show active" id="bordered-home"
									role="tabpanel" aria-labelledby="home-tab">
									<!-- Default Card -->

									<div class="row row-cols-1 row-cols-md-3 g-4">
										<form th:each="tm:${teamList}">
											<input type="hidden" th:name="${_csrf.parameterName}"
												th:value="${_csrf.token}"> <input type="hidden"
												name="prjNo" th:value="${tm.prjNo}">
											<div class="col teamSelect">
												<div class="card size">
													<div class="card-body">
														<br>
														<h5 class="card-text">[[${tm.nm}]]</h5>
														<h6>[[${tm.empNo}]]</h6>
														<h6 class="card-subtitle mb-2 text-muted">[[${tm.auth}]]</h6>
													</div>
												</div>
											</div>
										</form>
									</div>

									<!--프로젝트 팀원 추가-->
									<div class="card">
										<div class="card-body">
											<div id="rr">
												<br>
												<h4
													style="display: inline-block; padding-top: 10px; padding-right: 15px;">
													<i class="bi bi-person"></i> 
												</h4>
												<!-- 추가된 인원 보여주기 -->
												<div id="hello"></div>
												<button class="btn btn-outline-secondary" type="button"
													data-bs-toggle="collapse" data-bs-target="#collapseExample"
													aria-expanded="false" aria-controls="collapseExample">멤버
													추가</button>
												<!-- 버튼클릭시 뜨는 부분 -->
												<div class="collapse" id="collapseExample"
													style="padding-top: 30px;">
													<div class="" style="min-height: 200px;">
														<!-- 부서별 -->
														<ul id="browser" class="filetree treeview-famfamfam">
															<li id="depts"><span class="folder">Tune-Up</span>
																<ul>
																	<li class="closed"><span class="folder">인사팀</span>
																		<ul th:each="e:${addTeamList}">
																			<li th:if="${e.dept}=='인사'"><span
																				class="file name" th:attr="data-no=${e.empNo}">[[${e.nm}]]</span>
																			</li>
																		</ul></li>
																	<li class="closed"><span class="folder">기획팀</span>
																		<ul th:each="e:${empList}">
																			<li th:if="${e.dept}=='기획'"><span
																				class="file name" th:attr="data-no=${e.empNo}">[[${e.nm}]]</span>
																			</li>
																		</ul></li>
																	<li class="closed"><span class="folder">영업팀</span>
																		<ul th:each="e:${empList}">
																			<li th:if="${e.dept}=='영업'"><span
																				class="file name" th:attr="data-no=${e.empNo}">[[${e.nm}]]</span>
																			</li>
																		</ul></li>
																	<li class="closed"><span class="folder">회계팀</span>
																		<ul th:each="e:${empList}">
																			<li th:if="${e.dept}=='회계'"><span
																				class="file name" th:attr="data-no=${e.empNo}">[[${e.nm}]]</span>
																			</li>
																		</ul></li>
																	<li class="closed"><span class="folder">개발팀</span>
																		<ul th:each="e:${empList}">
																			<li th:if="${e.dept}=='개발'"><span
																				class="file name" th:attr="data-no=${e.empNo}">[[${e.nm}]]</span>
																			</li>
																		</ul></li>
																</ul></li>
														</ul>
														<!-- 부서별 -->
													</div>
													<!-- 인원선택하면 추가되는 부분 -->
													<div id="selectPerson"></div>
													<button id="personInsert" type="button">추가</button>
													
													<!-- 인원선택하면 추가되는 부분 -->
												</div>
												
												<!-- 버튼클릭시 뜨는 부분  -->
											</div>
											<!-- 프로젝트 팀원 추가 -->
										</div>
									</div>
								</div>
								<!-- End Default Card -->
							</div>
							
							<!-- 관리자 탭 -->					
							<div class="tab-pane fade row row-cols-1 row-cols-md-3 g-4" id="bordered-profile" role="tabpanel"
								aria-labelledby="profile-tab">
									<div class="card-body2">
										<h5 class="card-title2"></h5>
										<div class="row row-cols-1 row-cols-md-3 g-4" >
										<form class="authFrm" th:each="ath : ${authList}">
											<input type="hidden" th:name="${_csrf.parameterName}"
												th:value="${_csrf.token}"> <input type="hidden"
												name="prjNo" th:value="${ath.prjNo}">
												<input type="hidden"
												name="prjNo" th:value="${ath.auth}">
											<div class="col authSelect">
												<div class="card size">
													<div class="card-body">
														<br>
														<h5 class="card-text">[[${ath.nm}]]</h5>
														<h6>[[${ath.empNo}]]</h6>
														<h6>[[${ath.empNo}]]</h6>
													</div>
												</div>
											</div>
										</form>
									</div>
										
										
										
										
										
										
										
										
										
										
										
									</div>
								</div>
								<!-- End Default Card -->
							</div>
						</div>
						<!-- End Bordered Tabs -->


						<div class="#" align="right"></div>

					</div>
				</div>


		</section>


		<script>
		//부서별 사원이름 클릭시 추가되는 기능
		$("#depts").on("click", ".name", e=>{
			let empName = $(e.target).text(); //클릭한 사원의 이름
			let empNo = $(e.target).data("no"); //클릭한 사원의 사원번호
			$("#selectPerson").append("<div><span data-no='"+ empNo +"'>"+empName+"</span><i class='bi bi-x' style='color: red;'></i></div>");
		})
		
		//추가된 사원 삭제
		$("#rr").on("click", ".bi-x", e=>{
			let deleteNo = $(e.target).prev().data("no"); //삭제클릭한 사원의 사원번호
			$("#scheduleFrm").find("#"+deleteNo+"").remove();
			$(e.target).parent().remove();
		})
		
		//추가한 사원모두 추가되는 기능 (등록버튼)
		$("#personInsert").on("click", e=>{
			let people = $(e.target).prev().find('span');
			$.each(people, (idx, p)=>{
				$("#hello").append("<div><span data-no='"+$(p).data("no")+"'>"+$(p).text()+"</span><i class='bi bi-x' style='color: red;'></i></div>");
			
				//등록하면 hidden input창에 추가되도록(데이터를 보내기 위해서)
				$("#scheduleFrm").append("<input type='hidden' id='"+$(p).data("no")+"' name='teamEmpNo' value='"+$(p).data("no")+"'>")
			})
			$(e.target).prev().html("");
			
		})
		
		//input창 enter키 누르면 submit되는거 방지
		$('input[type="text"]').keydown(function() {
		    if (event.keyCode === 13) {
		        event.preventDefault();
		    }
		});
	</script>
	</main>
</body>
</html>

